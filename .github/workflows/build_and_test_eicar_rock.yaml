name: Build and Test EICAR Rock

on:
  push:
  workflow_dispatch:

jobs:
  build:
    uses: canonical/oci-factory/.github/workflows/Build-Rock.yaml@main
    with:
      oci-archive-name: "eicar-rock"
      rock-repo: canonical/rocks-toolbox
      rock-repo-commit: rework_oci-factory_workflow_docs
      rockfile-directory: eicar_rock/1.0/

  test:
    uses: canonical/oci-factory/.github/workflows/Test-Rock.yaml@main
    needs: [build]
    continue-on-error: true # we expect malware scan to fail
    with:
      oci-archive-name: "eicar-rock"
      test-black-box: true
      test-efficiency: true
      test-malware: true
      test-oci-compliance: true
      test-vulnerabilities: true
