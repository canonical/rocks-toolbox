name: Test EICAR Rock


on:
    push:
        paths:
            - .github/workflows/Test_EICAR_Rock.yaml
    workflow_dispatch:


jobs:
    build-rock:
        name: Build Rock
        uses: clay-lake/oci-factory/.github/workflows/Build-Rock.yaml@refactor-workflows
        with:
            oci-archive-name: "eicar-rock.rock"
            rock-repo: "canonical/rocks-toolbox"
            rock-repo-commit: "oci-factory_workflows"
            rockfile-directory: "oci-factory_workflows/rocks/eicar"


    test-rock:
        name: Test Rock
        uses: clay-lake/oci-factory/.github/workflows/Test-Rock.yaml@refactor-workflows
        needs: [build-rock]
        with:
            oci-archive-name: "${{ inputs.oci-archive-name }}"
        

